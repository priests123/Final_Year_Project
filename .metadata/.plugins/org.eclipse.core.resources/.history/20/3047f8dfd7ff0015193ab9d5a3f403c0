package importToDB;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.HashSet;
import java.util.Iterator;

public class SQLDatabase {

	private static Connection DBConn;
	
	public static void OpenConnection() {
		try {
			Class.forName("com.microsoft.sqlserver.jdbc.SQLServerDriver");
		} catch (ClassNotFoundException e1) {
			System.out.println("No associated SQL driver");
			e1.printStackTrace();
		}
		
		String URL = "jdbc:sqlserver://localhost:1433;DatabaseName=RailTransportation";			
		String user = "Rail";
		String pass = "Rail";
		
		try {
			DBConn = DriverManager.getConnection(URL,user,pass);
		} catch (SQLException e) {
			System.out.println("No connection to RailTransportation database");
			e.printStackTrace();
		}
		if(!DBConn.equals(null)){
			System.out.println("Connected to the Rail Transportation Database");
		}
	}
	
	public static ArrayList<String> selectAllFromStation(String sql){
		ArrayList<String> allStation = new ArrayList<String>();
		try{
			ResultSet result = DBConn.createStatement().executeQuery(sql);
			while(result.next()){
				allStation.add(result.getString(1));
			}
		} catch (SQLException e) {
			System.out.println("SELECT Station_Name FROM Station, query failed");
			e.printStackTrace();
		}
		return allStation;
	}
	
	public static void addNewStations(HashSet<String> uniqueStationsInFile){
		ArrayList<String> uniqueStations = new ArrayList<String>(uniqueStationsInFile);
		int countAdded = 0;
		for(int a = 0; a < uniqueStations.size(); a++){
			try{
				PreparedStatement statement = DBConn.prepareStatement("INSERT INTO Station (Station_Name) VALUES (?)");
				statement.setString(1, uniqueStations.get(a));
				int rowInserted = statement.executeUpdate();
				if(rowInserted > 0)
					countAdded++;
			} catch (SQLException e) {
				System.out.println("Failed to insert station value " + uniqueStations.get(a));
				e.printStackTrace();
			}	
		}
		System.out.println("Stations that should be added = " + uniqueStations.size());
		System.out.println("Stations added = " + countAdded);
	}
	
}
